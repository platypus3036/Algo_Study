# .github/workflows/generate-daily-template.yml

name: Generate Daily Study Template

on:
  workflow_dispatch:
    inputs:
      date:
        description: '폴더 이름으로 사용할 날짜 (yymmdd 형식)'
        required: true
        default: $(date +'%y%m%d')
      problems_info:
        description: "문제 정보를 '이름|링크|난이도' 형식으로, 문제 간에는 세미콜론(;)으로 구분하여 입력"
        required: true
        default: 'A+B|https://...|Bronze; 문제이름2|https://...|Gold'

jobs:
  generate-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Create Common Study Template
        run: |
          TARGET_DATE=${{ github.event.inputs.date }}
          PROBLEMS_INPUT=${{ github.event.inputs.problems_info }}

          # 1. 날짜 폴더 생성 및 기본 README 파일 생성
          mkdir -p "$TARGET_DATE"
          cat <<EOF > "${TARGET_DATE}/README.md"
# 🗓️ ${TARGET_DATE} 스터디 회고

## 🎯 이번 주 스터디 목표 및 주요 학습 내용

- 

---

## 📚 문제별 토론 및 회고

EOF

          # 2. 세미콜론(;)으로 각 문제 정보를 분리하여 배열로 만듦
          IFS=';' read -ra PROBLEMS_ARRAY <<< "$PROBLEMS_INPUT"
          
          # 3. 각 문제 정보를 순회하며 처리
          for problem_info in "${PROBLEMS_ARRAY[@]}"; do
            # 4. 파이프(|)로 이름, 링크, 난이도를 다시 분리
            IFS='|' read -r name link difficulty <<< "$problem_info"
            
            # 앞뒤 공백 제거
            name=$(echo "$name" | xargs)
            link=$(echo "$link" | xargs)
            difficulty=$(echo "$difficulty" | xargs)

            # 5. 날짜별 README 파일에 템플릿 추가
            cat <<EOM >> "${TARGET_DATE}/README.md"

### 📝 [${name}](${link})

- **난이도**: ${difficulty}
- **주요 접근법 요약**: (예: A는 DFS, B는 DP로 접근)
- **토론 내용 및 피드백**: (예: 시간 복잡도 개선 방안, 코드 가독성 논의)

EOM
          done
          
          # 6. KPT 회고 및 다음 주 계획 섹션을 README에 추가
          cat <<EOF >> "${TARGET_DATE}/README.md"

---

## 🚀 KPT 회고 (Keep, Problem, Try)

### Keep (유지할 점)

- 

### Problem (개선할 점)

- 

### Try (다음에 시도할 점)

- 

---

## 🗓️ 다음 주 계획

- 
EOF

      - name: Commit and Push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          git commit -m "docs: ${TARGET_DATE} 스터디 회고 템플릿 생성" || exit 0
          git push
