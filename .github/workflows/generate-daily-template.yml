name: Generate Daily Study Template

on:
  workflow_dispatch:
    inputs:
      date:
        description: 'í´ë” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•  ë‚ ì§œ (yymmdd í˜•ì‹)'
        required: true
      problems:
        description: 'ë¬¸ì œì™€ ë§í¬ ëª©ë¡ (í˜•ì‹: ë¬¸ì œì´ë¦„1:ë§í¬1,ë¬¸ì œì´ë¦„2:ë§í¬2)'
        required: true
        default: 'ë¬¸ì œA:https://example.com/problem/1,ë¬¸ì œB:https://example.com/problem/2'

jobs:
  generate-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create study template
        run: |
          TARGET_DATE="${{ github.event.inputs.date }}"
          PROBLEM_LIST="${{ github.event.inputs.problems }}"
          
          mkdir -p "$TARGET_DATE"
          
          # README íŒŒì¼ì˜ ìƒë‹¨ ë¶€ë¶„ì„ ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
          README_CONTENT=$(cat <<-EOF
          # ğŸ—“ï¸ ${TARGET_DATE} ìŠ¤í„°ë”” íšŒê³ 

          ## ğŸ¯ ì´ë²ˆ ì£¼ ìŠ¤í„°ë”” ëª©í‘œ ë° ì£¼ìš” í•™ìŠµ ë‚´ìš©
          - 

          ---

          ## ğŸ“š ë¬¸ì œë³„ í† ë¡  ë° íšŒê³ 
          EOF
          )

          # ì…ë ¥ë°›ì€ ë¬¸ì œ ëª©ë¡ì„ ì‰¼í‘œ(,)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
          IFS=',' read -ra PROBLEMS_ARRAY <<< "$PROBLEM_LIST"

          # ê° ë¬¸ì œì— ëŒ€í•œ ì„¹ì…˜ì„ ë°˜ë³µí•˜ì—¬ ì¶”ê°€í•˜ê³ , ë¬¸ì œë³„ í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          for item in "${PROBLEMS_ARRAY[@]}"; do
            PROBLEM_NAME="${item%%:*}"
            PROBLEM_LINK="${item#*:}"
            
            # ë¬¸ì œ ì´ë¦„ ì•ë’¤ì˜ ê³µë°±ì„ ì œê±°í•©ë‹ˆë‹¤.
            PROBLEM_NAME=$(echo "$PROBLEM_NAME" | sed 's/^[ \t]*//;s/[ \t]*$//')

            # ê° ë¬¸ì œ ì´ë¦„ìœ¼ë¡œ í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ìˆ˜ì •ëœ ë¶€ë¶„)
            mkdir -p "${TARGET_DATE}/${PROBLEM_NAME}"
            
            README_CONTENT+=$(cat <<-EOM

          ### ğŸ“ ${PROBLEM_NAME}
          - **ë¬¸ì œ ë§í¬**: [ë°”ë¡œê°€ê¸°](${PROBLEM_LINK})
          - **ë‚œì´ë„**: 
          - **ì£¼ìš” ì ‘ê·¼ë²• ìš”ì•½**: 
          - **í† ë¡  ë‚´ìš© ë° í”¼ë“œë°±**: 
          EOM
          )
          done

          # KPT íšŒê³  ë° ë‹¤ìŒ ì£¼ ê³„íš ì„¹ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
          README_CONTENT+=$(cat <<-EOF

          ---

          ## ğŸš€ KPT íšŒê³  (Keep, Problem, Try)
          ### Keep (ìœ ì§€í•  ì )
          - 

          ### Problem (ê°œì„ í•  ì )
          - 

          ### Try (ë‹¤ìŒì— ì‹œë„í•  ì )
          - 

          ---

          ## ğŸ—“ï¸ ë‹¤ìŒ ì£¼ ê³„íš
          - 
          EOF
          )

          # ì™„ì„±ëœ ë‚´ìš©ì„ íŒŒì¼ì— í•œ ë²ˆì— ì”ë‹ˆë‹¤.
          echo "$README_CONTENT" > "${TARGET_DATE}/README.md"

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          
          # ë³€ê²½ëœ íŒŒì¼ì´ ìˆì„ ê²½ìš°ì—ë§Œ ì»¤ë°‹ê³¼ í‘¸ì‹œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
          if ! git diff-index --quiet HEAD; then
            git commit -m "docs: Create study retrospective template for ${TARGET_DATE}"
            git push
          else
            echo "No changes to commit."
          fi
