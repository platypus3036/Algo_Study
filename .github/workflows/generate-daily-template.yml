name: Generate Daily Study Template

on:
  workflow_dispatch:
    inputs:
      date:
        description: 'í´ë” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•  ë‚ ì§œ (yymmdd í˜•ì‹)'
        required: true
        # defaultëŠ” ì •ì ì¸ ê°’ë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë¯€ë¡œ ë™ì  ìƒì„± êµ¬ë¬¸ ì œê±°
      problems:
        description: 'ë¬¸ì œì™€ ë§í¬ ëª©ë¡ (í˜•ì‹: ë¬¸ì œì´ë¦„1:ë§í¬1,ë¬¸ì œì´ë¦„2:ë§í¬2)'
        required: true
        default: 'ë¬¸ì œA:https://example.com/problem/1,ë¬¸ì œB:https://example.com/problem/2'

jobs:
  generate-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create study template
        run: |
          TARGET_DATE=${{ github.event.inputs.date }}
          PROBLEM_LIST=${{ github.event.inputs.problems }}
          
          mkdir -p "$TARGET_DATE"
          
          # ì—¬ëŸ¬ë²ˆ catìœ¼ë¡œ íŒŒì¼ì„ ì“°ëŠ” ëŒ€ì‹ , ë³€ìˆ˜ì— ë‚´ìš©ì„ ëˆ„ì í•œ í›„ í•œë²ˆì— ì”ë‹ˆë‹¤.
          README_CONTENT=$(cat <<-EOF
          # ğŸ—“ï¸ ${TARGET_DATE} ìŠ¤í„°ë”” íšŒê³ 

          ## ğŸ¯ ì´ë²ˆ ì£¼ ìŠ¤í„°ë”” ëª©í‘œ ë° ì£¼ìš” í•™ìŠµ ë‚´ìš©

          - 

          ---

          ## ğŸ“š ë¬¸ì œë³„ í† ë¡  ë° íšŒê³ 
          EOF
          )

          # ì‰¼í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì œ ëª©ë¡ì„ ë°°ì—´ë¡œ ë³€í™˜
          IFS=',' read -ra PROBLEMS_ARRAY <<< "$PROBLEM_LIST"

          for item in "${PROBLEMS_ARRAY[@]}"; do
            # cut ëŒ€ì‹  Bash ë§¤ê°œë³€ìˆ˜ í™•ì¥ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œ ì´ë¦„ê³¼ ë§í¬ ë¶„ë¦¬
            # ':'ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì• ë¶€ë¶„ì€ PROBLEM_NAME, ë’· ë¶€ë¶„ì€ PROBLEM_LINK
            PROBLEM_NAME="${item%%:*}"
            PROBLEM_LINK="${item#*:}"
            
            # ì•ë’¤ ê³µë°± ì œê±° (xargs ëŒ€ì‹  sed ì‚¬ìš©, í˜¹ì€ ì…ë ¥ ì‹œ ê³µë°± ì£¼ì˜)
            PROBLEM_NAME=$(echo "$PROBLEM_NAME" | sed 's/^[ \t]*//;s/[ \t]*$//')
            
            # ê° ë¬¸ì œì— ëŒ€í•œ ì„¹ì…˜ì„ ë‚´ìš©ì— ì¶”ê°€
            README_CONTENT+=$(cat <<-EOM

          ### ğŸ“ ${PROBLEM_NAME}

          - **ë¬¸ì œ ë§í¬**: [ë°”ë¡œê°€ê¸°](${PROBLEM_LINK})
          - **ë‚œì´ë„**: 
          - **ì£¼ìš” ì ‘ê·¼ë²• ìš”ì•½**: 
          - **í† ë¡  ë‚´ìš© ë° í”¼ë“œë°±**: 
          EOM
          )
          done

          # KPT ë° ë‹¤ìŒ ì£¼ ê³„íš ì„¹ì…˜ ì¶”ê°€
          README_CONTENT+=$(cat <<-EOF

          ---

          ## ğŸš€ KPT íšŒê³  (Keep, Problem, Try)

          ### Keep (ìœ ì§€í•  ì )

          - 

          ### Problem (ê°œì„ í•  ì )

          - 

          ### Try (ë‹¤ìŒì— ì‹œë„í•  ì )

          - 

          ---

          ## ğŸ—“ï¸ ë‹¤ìŒ ì£¼ ê³„íš

          - 
          EOF
          )

          # ìµœì¢…ì ìœ¼ë¡œ ìƒì„±ëœ ë‚´ìš©ì„ README.md íŒŒì¼ì— ì”ë‹ˆë‹¤.
          echo "$README_CONTENT" > "${TARGET_DATE}/README.md"

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          
          # ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ ë° í‘¸ì‹œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
          if ! git diff-index --quiet HEAD; then
            git commit -m "docs: Create study retrospective template for ${TARGET_DATE}"
            git push
          else
            echo "No changes to commit."
          fi

